<!DOCTYPE html>
<html>
    <head>
        <title>BCI Vis Test</title>
        <script src="https://threejs.org/build/three.min.js"></script>
        <style>
            body { margin: 0; }
            canvas { display: block; }
        </style>
    </head>
    <body>
        <div>
            <h1>EEG Node Visualization</h1>
            <p>Click and drag to rotate the camera.</p>
            <p>Zoom in and out using the scroll wheel.</p>
            <!-- Setup Sensitivity Slider -->
            <p>Adjust camera sensitivity:</p>
            <input type="range" min="1" max="10" value="5" step="0.5" class="slider" id="sensSlider">
        </div>
        <div>
            <script>
                //Generate coordinates of truncated icosahedron as test shape
                var nodes = [];
                const v = (1 + Math.sqrt(5)) / 2; 
                const positions = [  
                [-1,  v,  0],
                [ 1,  v,  0],
                [-1, -v,  0],
                [ 1, -v,  0],
                [ 0, -1,  v],
                [ 0,  1,  v],
                [ 0, -1, -v],
                [ 0,  1, -v],
                [ v,  0, -1],
                [ v,  0,  1],
                [-v,  0, -1],
                [-v,  0,  1]
                ];
    
                // Get coordinate values
                for (var i = 0; i < positions.length; i++) {
                    var x = positions[i][0]
                    var y = positions[i][1]
                    var z = positions[i][2]
    
                    // Format data as "nodeName (x, y, z)" and add to nodes array
                    nodes.push("node" + i + " (" + x + ", " + y + ", " + z + ")");
                }
                
                // Begin parsing input text
                var spheres = [];
                
                // Create a sphere for each node
                for (var i = 0; i < nodes.length; i++) {
                    var node = nodes[i];
                    
                    // Extract name or ID
                    var name = node.split(" ")[0];
    
                    // Get Coordinate Data
                    var coords = node.substring(node.indexOf("(") + 1, node.indexOf(")"));
                    var xyz = coords.split(", "); //store values as array of strings
    
                    // Convert each from string to float
                    var x = parseFloat(xyz[0]);
                    var y = parseFloat(xyz[1]);
                    var z = parseFloat(xyz[2]);
    
                    // Create a sphere
                    var sphere = new THREE.SphereGeometry(0.1, 32, 32); // (size, resolution...)
                    sphere.translate(x, y, z);  //translate sphere to it's position
                    spheres.push(sphere);
                }
                
                // Create a group to hold the spheres
                var group = new THREE.Group();
                
                // Add each sphere to the group
                for (var i = 0; i < spheres.length; i++) {
                    var sphere = spheres[i];
                    var mesh = new THREE.Mesh(sphere, new THREE.MeshBasicMaterial({ color: 0xffffff })); //white sphere mesh
                    group.add(mesh);
                }
                
                // Create a scene, camera, and renderer
                var scene = new THREE.Scene();
                var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                var renderer = new THREE.WebGLRenderer();
                var sensitivity = 0.005;  //default sensitivity
                
                // Add the group to the scene and setup default camera position
                scene.add(group);
                camera.position.z = 5; 
                
                // Set the renderer size
                renderer.setSize(window.innerWidth, window.innerHeight);
                
                // Append the renderer to the body
                document.body.appendChild(renderer.domElement);
                
                // Create a flag to track whether the left mouse button is being held
                var leftButtonDown = false;
                
                // Listen for mousedown events
                document.addEventListener("mousedown", (event) => {
                    if (event.button === 0) {
                        leftButtonDown = true;
                    }
                });
                
                // Listen for mouseup events
                document.addEventListener("mouseup", (event) => {
                    if (event.button === 0) {
                        leftButtonDown = false;
                    }
                });
                
                // Listen for mousemove events
                document.addEventListener("mousemove", (event) => {
                    //Apply Rotation to the group of spheres
                    if (leftButtonDown) {
                        group.rotation.y += event.movementX * sensitivity;
                        group.rotation.x += event.movementY * sensitivity;
                    }
                });
    
                //Mouse sensitivity slider
                var sensSlider = document.getElementById("sensSlider");
    
                // Prevent moving camera when using slider
                sensSlider.addEventListener("mousedown", function() {
                    sensitivity = 0.0;
                });
    
                //Update mouse sensitivity when slider is released
                sensSlider.addEventListener("mouseup", function() {
                    sensitivity = sensSlider.value * 0.001;
                });
    
                // Listen for mouse wheel events
                window.addEventListener("wheel", (event) => {
                    event.preventDefault();   // FIXME: Doesn't prevent page scrolling
                    var delta = event.deltaY; //changes sign depending on scroll direction
    
                    // Zoom in or out
                    camera.position.z += delta * 0.01;
                });
    
                // Render scene
                var render = function () {
                    requestAnimationFrame(render);
                    renderer.render(scene, camera);
                };
                
                render();
        
            </script>
        </div>
    </body>
</html>